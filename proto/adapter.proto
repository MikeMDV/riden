syntax="proto3";

option go_package = "riden/adapter/adapter";

package adapter;

// The Adapter service RPC definitions are implemented as bi-directional
// streaming RPCs. These RPCs may be pushed by either the client or the server at any
// time. The two streams operate independently, so clients and servers can read and
// write in whatever order they like. The messages must be defined in terms of a
// client request and a server response, but since these are meant to be asynchronous
// messages, the messages from the MockLogic(client) to the Adapter(server) will have an
// Empty response that the Adapter(server) will not send. The Adapter to MockLogic
// messages will have an Empty request that the MockLogic will not send to the Adapter.
// The MockLogic(client) is not required to send the Empty requests in order to receive
// messages from the Adapter(server) and the Adapter is not required to send
// the Empty response to the MockLogic after receiveing a message.

// The Adapter service definition
service Adapter {
    // A bi-directional streaming RPC.
    // The MockLogic(gRPC client) receives a Reserve request that an API client has sent
    rpc ReserveTrip(stream Empty) returns (stream ReserveTripMessage) {}

    // A bi-directional streaming RPC.
    // The MockLogic(gRPC client) sends an Acknowledgement that a previously sent
    // ReserveMessage is being handled
    rpc Ack(stream AckMessage) returns (stream Empty) {}

    // A bi-directional streaming RPC.
    // The MockLogic(gRPC client) receives an AtDock message that an API client has sent
    rpc AtDock(stream Empty) returns (stream AtDockMessage) {}

    // A bi-directional streaming RPC.
    // The MockLogic(gRPC client) receives an OnBoat message that an API client has sent
    rpc OnBoat(stream Empty) returns (stream OnBoatMessage) {}

    // A bi-directional streaming RPC.
    // The MockLogic(gRPC client) receives an OffBoat message that an API client has sent
    rpc OffBoat(stream Empty) returns (stream OffBoatMessage) {}

    // A bi-directional streaming RPC.
    // The MockLogic(gRPC client) sends an BoatStatus message that the Adapter will
    // broadcast
    rpc BoatStatus(stream BoatStatusMessage) returns (stream Empty) {}

    // A bi-directional streaming RPC.
    // The MockLogic(gRPC client) sends an Arrived message that the Adapter will send
    // to the API client
    rpc Arrived(stream ArrivedMessage) returns (stream Empty) {}
}

// Address represents the number and street name of an address where a dock is
// located
message Address {
    int32  number = 1;
    string street = 2;
}

// Dock represents the address and gangway combination where the client will
// board the boat
message Dock {
    Address address = 1;
    string  gangway = 2;
}

// Boat represents the data for individual boats
message Boat {
    int32  boat_id = 1;
    string name    = 2;
}

// ServiceState represents enum values for the following states of the
// boats
enum ServiceState {
    UNKNOWN     = 0;
    ON_TIME     = 1;
    DELAYED     = 2;
    UNAVAILABLE = 3;
}

// ClientData holds the client connection data that the Adapter needs to
// send messages
message ClientData {
    string conn_name = 1;
    string conn_type = 2;
}

// ReserveTripAPIMessage represents the ReserveTrip API message that a client
// sends to the MockLogic
message ReserveTripAPIMessage {
    // message_type is a const = "reserve_trip"
    string message_type     = 1;
    string auth_token       = 2;
    string client_id        = 3;
    Dock   source_dock      = 5;
    Dock   destination_dock = 6;
}

// AckAPIMessage represents the Ack API message that the MockLogic
// sends to a client indicating that a ReserveTrip message is being processed
message AckAPIMessage {
    // message_type is a const = "ack"
    string message_type   = 1;
    string client_id      = 2;
    bool   is_reserved    = 3;
    Boat   boat           = 4;
    string transaction_id = 5;
}

// AtDockAPIMessage reperesents the AtDock API message that the client
// sends to the MockLogic
message AtDockAPIMessage {
    // message_type is a const = "at_dock"
    string message_type   = 1;
    string client_id      = 2;
    Boat   boat           = 3;
    Dock   dock           = 4;
    string transaction_id = 5;
}

// OnBoatAPIMessage reperesents the OnBoat API message that the client
// sends to the MockLogic
message OnBoatAPIMessage {
    // message_type is a const = "on_boat"
    string message_type   = 1;
    string client_id      = 2;
    Boat   boat           = 3;
    string transaction_id = 4;
}

// OffBoatAPIMessage reperesents the OffBoat API message that the client
// sends to the MockLogic
message OffBoatAPIMessage {
    // message_type is a const = "off_boat"
    string message_type   = 1;
    string client_id      = 2;
    Boat   boat           = 3;
    string transaction_id = 4;
}

// BoatStatusAPIMessage represents the BoatStatus API message that the MockLogic
// sends to all clients
message BoatStatusAPIMessage {
    // message_type is a const = "boat_status"
    string       message_type  = 1;
    Boat         boat          = 2;
    ServiceState service_state = 3;
    Dock         previous_dock = 4;
    Dock         current_dock  = 5;
    Dock         next_dock     = 6;
}

// ArrivedAPIMessage reperesents the Arrived API message that the
// MockLogic sends to the client
message ArrivedAPIMessage {
    // message_type is a const = "arrived"
    string message_type   = 1;
    string client_id      = 2;
    Boat   boat           = 3;
    Dock   dock           = 4;
    string transaction_id = 5;
}

// ReserveTripMessage represents the Reserve API message and the client
// connection data that the Adapter uses
message ReserveTripMessage {
    ReserveTripAPIMessage api_message = 1;
    ClientData            client_data = 2;
}

// AckMessage represents the Ack API message and the client
// connection data that the Adapter uses
message AckMessage {
    AckAPIMessage api_message = 1;
    ClientData    client_data = 2;
}

// AtDockMessage represents the AtDock API message and the client
// connection data that the Adapter uses
message AtDockMessage {
    AtDockAPIMessage api_message = 1;
    ClientData       client_data = 2;
}

// OnBoatMessage represents the OnBoat API message and the client
// connection data that the Adapter uses
message OnBoatMessage {
    OnBoatAPIMessage api_message = 1;
    ClientData       client_data = 2;
}

// OffBoatMessage represents the OffBoat API message and the client
// connection data that the Adapter uses
message OffBoatMessage {
    OffBoatAPIMessage api_message = 1;
    ClientData        client_data = 2;
}

// BoatStatusMessage represents the BoatStatus API message and the client
// connection data that the Adapter uses
message BoatStatusMessage {
    BoatStatusAPIMessage api_message = 1;
    ClientData           client_data = 2;
}

// ArrivedMessage represents the Arrived API message and the client
// connection data that the Adapter uses
message ArrivedMessage {
    ArrivedAPIMessage api_message = 1;
    ClientData        client_data = 2;
}

// Empty represents an empty message that is not expected to
// ever be sent or received and is used for one half of a
// bi-directional streaming message service
message Empty {}